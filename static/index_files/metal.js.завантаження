(()=>{const e=Calc.form.querySelector("select[name=metal]"),t=Calc.form.querySelector("select[name=mark]"),a=Calc.form.querySelectorAll(".js-input-size"),o=Calc.form.querySelectorAll(".assortment-button"),r=Calc.form.querySelectorAll(".gost-select"),n=Calc.form.querySelectorAll(".gost-number-select");function s(e){if(!e)return;const t=e.dataset.voc,a=e.options[e.selectedIndex].dataset;for(let e in a){let o=Calc.form.querySelector("."+t+"-"+e+"-size");o&&(o.textContent=a[e])}}Calc.form.assortment.value&&s(Calc.form[Calc.form.assortment.value+"_number"]),e.addEventListener("change",(a=>{const o=JSON.parse(e.options[e.selectedIndex].dataset.marks);t.innerHTML="",t.insertAdjacentHTML("afterbegin",'<option value="">- марка -</option>');for(let e in o)t.insertAdjacentHTML("beforeend",'<option value="'+o[e]+'">'+o[e]+"</option>")})),a.forEach((e=>{e.addEventListener("blur",(e=>{const t=e.target.dataset.voc,a=e.target.dataset.letter,o=e.target.value>0?e.target.value:a;Calc.form.querySelector("."+t+"-"+a+"-size").textContent=o}))})),o.forEach((e=>{e.addEventListener("click",(t=>{const a=document.getElementById("assortment-error");a&&a.remove(),"sheet"!=e.dataset.value&&"pipe"!=e.dataset.value||Calc.toggleFields("size_or_voc","size")}))})),r.forEach((e=>{e.addEventListener("change",(e=>{const t=e.target.value,a=e.target.dataset.voc,o=e.target.dataset.title,r=e.target.dataset.sizes.split(",").filter(Boolean),n=e.target.closest(".calc-frow").querySelector(".gost-number-select");n.setAttribute("disabled","disabled"),n.insertAdjacentHTML("afterbegin",'<option value="" selected>загрузка...</option>');let s=new XMLHttpRequest;s.open("GET","https://calcus.ru/ajax/get_assortment_items?voc="+a+"&id="+t,!0),s.onload=function(){const e=JSON.parse(this.response);n.removeAttribute("disabled"),n.innerHTML="";let t=document.createElement("option");t.value="",t.textContent=`- ${o} -`;for(let e of r)t.dataset[e]=e;n.insertAdjacentElement("beforeend",t);for(const[t,a]of Object.entries(e)){let e=document.createElement("option");e.value=t,e.textContent=t;for(let t of r)e.dataset[t]=a[t];n.insertAdjacentElement("beforeend",e)}},s.send()}))})),n.forEach((e=>{e.addEventListener("change",(t=>{s(e)}))}))})();